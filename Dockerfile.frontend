# Stage 1: Build
FROM node:22-slim AS build-stage
WORKDIR /app
# Copy package files for caching
COPY frontend/package*.json ./
RUN npm install
# Copy frontend source code
COPY frontend/ .
# Define build-time argument for API URL
ARG VITE_API_URL
ENV VITE_API_URL=$VITE_API_URL
# Build the production assets
RUN npm run build

# Stage 2: Serve
FROM node:22-slim
WORKDIR /app
# Install a lightweight static server
RUN npm install -g serve
# Copy built assets from build-stage
COPY --from=build-stage /app/dist ./dist
# Expose port
EXPOSE 3000
# Run the server
CMD ["serve", "-s", "dist", "-l", "3000"]
